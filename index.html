<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Dino Synth Forest</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- GSAP -->
<script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
<script src="https://unpkg.com/gsap@3/dist/ScrollTrigger.min.js"></script>

<style>
html,body{
  margin:0;
  height:100%;
  overflow-x:hidden;
  background:#02030a;
  font-family:sans-serif;
}

/* ===== Forest Background ===== */
.forest-bg{
  position:fixed;
  inset:0;
  background:
    radial-gradient(circle at 50% 30%, #1c2b2a, #02030a 70%),
    linear-gradient(#041010,#000);
  overflow:hidden;
}

/* drifting fog */
.fog{
  position:absolute;
  inset:-50%;
  background:radial-gradient(circle, rgba(255,255,255,.05), transparent 70%);
  animation:fogmove 60s linear infinite;
}

@keyframes fogmove{
  from{transform:translateX(0);}
  to{transform:translateX(50%);}
}

/* Parallax Layers */
.layer{
  position:absolute;
  inset:0;
  background-repeat:no-repeat;
  background-position:center bottom;
  background-size:cover;
}

.layer-back{
  background-image:
    radial-gradient(circle at 30% 60%, rgba(0,80,70,.6), transparent 60%);
}
.layer-mid{
  background-image:
    radial-gradient(circle at 70% 70%, rgba(0,120,100,.6), transparent 60%);
}
.layer-front{
  background-image:
    radial-gradient(circle at 50% 80%, rgba(0,160,120,.6), transparent 60%);
}

/* ===== Buttons ===== */
.synth-btn{
  width:64px;
  height:64px;
  border-radius:9999px;
  background:#0a3a3a;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:28px;
  cursor:pointer;
  transition:0.2s;
  box-shadow:0 0 10px #0ff0;
}

.synth-btn.active{
  background:#16f5c4;
  box-shadow:
    0 0 20px #3ff,
    0 0 40px #3ff;
  animation:pulse 1.2s infinite;
}

@keyframes pulse{
  0%{transform:scale(1);}
  50%{transform:scale(1.1);}
  100%{transform:scale(1);}
}
</style>
</head>

<body>

<!-- Background -->
<div class="forest-bg">
  <div class="fog"></div>
  <div class="layer layer-back"></div>
  <div class="layer layer-mid"></div>
  <div class="layer layer-front"></div>
</div>

<!-- Spacer for scroll -->
<div class="h-[300vh]"></div>

<!-- UI -->
<div class="fixed bottom-6 w-full flex justify-center gap-4 z-50">
  <div class="synth-btn" data-sound="base">ü¶ï</div>
  <div class="synth-btn" data-sound="perc">ü•Å</div>
  <div class="synth-btn" data-sound="high">‚ú®</div>
  <div class="synth-btn" data-sound="nature">üåø</div>
  <div class="synth-btn" data-sound="dino">ü¶ñ</div>
</div>

<script>
/* ================================
   PARALLAX
================================ */
gsap.registerPlugin(ScrollTrigger);

gsap.to(".layer-back",{
  y:100,
  scrollTrigger:{scrub:true}
});
gsap.to(".layer-mid",{
  y:200,
  scrollTrigger:{scrub:true}
});
gsap.to(".layer-front",{
  y:300,
  scrollTrigger:{scrub:true}
});

/* ================================
   AUDIO ENGINE
================================ */

let audioCtx;
const tracks={};

/* simple wav builder so we can still use decodeAudioData */
function createWavBuffer(samples){
  const sampleRate=44100;
  const buffer=new ArrayBuffer(44+samples.length*2);
  const view=new DataView(buffer);

  function writeString(o,s){
    for(let i=0;i<s.length;i++)
      view.setUint8(o+i,s.charCodeAt(i));
  }

  writeString(0,"RIFF");
  view.setUint32(4,36+samples.length*2,true);
  writeString(8,"WAVE");
  writeString(12,"fmt ");
  view.setUint32(16,16,true);
  view.setUint16(20,1,true);
  view.setUint16(22,1,true);
  view.setUint32(24,sampleRate,true);
  view.setUint32(28,sampleRate*2,true);
  view.setUint16(32,2,true);
  view.setUint16(34,16,true);
  writeString(36,"data");
  view.setUint32(40,samples.length*2,true);

  let o=44;
  for(let i=0;i<samples.length;i++,o+=2){
    let s=Math.max(-1,Math.min(1,samples[i]));
    view.setInt16(o,s<0?s*0x8000:s*0x7fff,true);
  }
  return buffer;
}

/* generate simple loop waves */
function generateTone(freq){
  const len=44100*4;
  const arr=new Float32Array(len);
  for(let i=0;i<len;i++){
    arr[i]=Math.sin(2*Math.PI*freq*i/44100)*0.4;
  }
  return createWavBuffer(arr);
}

async function initAudio(){
  audioCtx=new AudioContext();

  const sources={
    base:generateTone(55),
    perc:generateTone(90),
    high:generateTone(880),
    nature:generateTone(440),
    dino:generateTone(30)
  };

  for(const key in sources){
    const audioBuffer=await audioCtx.decodeAudioData(sources[key]);
    const src=audioCtx.createBufferSource();
    src.buffer=audioBuffer;
    src.loop=true;

    const gain=audioCtx.createGain();
    gain.gain.value=0;

    src.connect(gain).connect(audioCtx.destination);
    src.start(0); // ‚òÖÂÖ®„Éà„É©„ÉÉ„ÇØÂêåÊúü

    tracks[key]={src,gain,active:false};
  }
}

document.body.addEventListener("click",async()=>{
  if(!audioCtx){
    await initAudio();
  }
},{once:true});

/* ================================
   BUTTON CONTROL
================================ */

document.querySelectorAll(".synth-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    const key=btn.dataset.sound;
    const track=tracks[key];
    if(!track) return;

    track.active=!track.active;

    btn.classList.toggle("active",track.active);

    track.gain.gain.cancelScheduledValues(audioCtx.currentTime);
    track.gain.gain.linearRampToValueAtTime(
      track.active?0.7:0,
      audioCtx.currentTime+1
    );
  });
});
</script>

</body>
</html>
